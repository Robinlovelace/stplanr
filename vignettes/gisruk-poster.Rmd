---
title: 'stplanr: A Package for Geographic Transport Data Science'
output:
  pdf_document:
    keep_tex: yes
    pandoc_args: [
      "-V", "classoption=twocolumn"
    ]
  word_document: default
bibliography: references.bib
abstract: |
  Tools for transport planning should be flexible, scalable and well-integrated with geographic data. **stplanr** meets each of these criteria by providing functionality commonly needed for transport planning in R, with an emphasis on spatial transport data. Reproducible code - https://github.com/ropensci/stplanr.
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(dev = 'pdf', out.width='\\textwidth')
```

# Introduction

**stplanr** is an R package for transport planning [@lovelace_stplanr:_2017].

Install **stplanr** from CRAN:

```{r, eval=FALSE}
install.packages("stplanr")
```

It automatically loads the **sp** package [@pebesma_classes_2005], for plotting etc:

```{r}
library(stplanr)
```

# OD Data

Perhaps the most common type of aggregate-level transport information is origin-destination ('OD') data [@bonnel_passive_2014].
  

```{r}
data("flow", package = "stplanr")
row.names(flow) <- NULL
head(flow[c(1:3)], 2) # some od data
```

```{r}
data("cents", package = "stplanr")
cents@data[1:2, 1:3] # point data
```

We use `od2line` to combine `flow` and `cents`, to join
the former to the latter (Figure 1). 

```{r, warning=FALSE, fig.cap="Geographical 'desire lines' created with stplanr from OD data."}
l <- od2line(flow = flow, zones = cents)
plot(l)
```

# Route networks

Route networks can be created and even navigated (Figure 2).

```{r lines_routes, out.width='50%', fig.cap='Visualisation of travel desire lines, with width proportional to number of trips between origin and destination (black) and routes allocated to network  (red) in the left-hand panel. The right hand panel shows the route network dataset generated by overline().', fig.show='hold'}
plot(route_network, lwd=0)
plot(l, lwd = l$All / 10, add = TRUE)
lines(routes_fast, col = "red")
routes_fast$All <- l$All
rnet <- overline(routes_fast, "All", fun = sum)
rnet$flow <- rnet$All / mean(rnet$All) * 3
plot(rnet, lwd = rnet$flow / mean(rnet$flow))
```

# The route to Manchester

We can find a route (e.g. to Manchester for GISRUK) using the `route_*()` functions (Figure 3):

```{r, eval=FALSE}
r = route_cyclestreet("Leeds, UK", "Manchester")
mapview(r)
```

<!-- ```{r, fig.cap="The route to GISRUK.", echo=FALSE, out.width="100%"} -->
<!-- download.file("https://cloud.githubusercontent.com/assets/1825120/25223541/8ef633d0-25b3-11e7-920a-933e2ba5b83f.png", "leeds-to-man.png") -->
<!-- knitr::include_graphics("leeds-to-man.png") -->
<!-- ``` -->

# Use in policy

**stplanr** was originally created to enable development of the Propensity to Cycle Tool [@lovelace_propensity_2017].
This is the UK's first open source, publicly accessible transport model that provides results at area, line and route network levels.
The PCT estimates cycling potential along all major cyclable roads in England (Figure 4).

<!-- ```{r, fig.cap="The Propensity to Cycle Tool in action. This shows the shift in cycling uptake in Leeds from a 'Go Dutch' scenario", echo=FALSE, out.width="100%"} -->
<!-- download.file("https://github.com/npct/pct/blob/master/flow-model/leeds-rnet-gov-go.png?raw=true", destfile = "leeds-rnet-gov-go.png") -->
<!-- knitr::include_graphics("leeds-rnet-gov-go.png") -->
<!-- file.remove("leeds-rnet-gov-go.png") -->
<!-- ``` -->




# References
